<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>B.19. Golang Middleware http.Handler - Dasar Pemrograman Golang</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="gitbook/style.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="styles/website.css"rel="stylesheet"><meta content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"name="google-site-verification"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="og:image"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="twitter:image"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="B-20-custom-mux-multiplexer.html"rel="next"/><link href="B-18-http-basic-auth.html"rel="prev"/></head><body><div class="book"><div class="book-summary"><div role="search"id="book-search-input"><input placeholder="Type to search"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="./"><a href="./">Introduction</a></li><li class="chapter"data-level="1.2"><span>A. Pemrograman Golang Dasar</span><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="1-berkenalan-dengan-golang.html"><a href="1-berkenalan-dengan-golang.html">A.1. Berkenalan Dengan Golang</a></li><li class="chapter"data-level="1.2.2"data-path="2-instalasi-golang.html"><a href="2-instalasi-golang.html">A.2. Instalasi Golang</a></li><li class="chapter"data-level="1.2.3"data-path="3-gopath-dan-workspace.html"><a href="3-gopath-dan-workspace.html">A.3. GOPATH Dan Workspace</a></li><li class="chapter"data-level="1.2.4"data-path="4-instalasi-editor.html"><a href="4-instalasi-editor.html">A.4. Instalasi Editor</a></li><li class="chapter"data-level="1.2.5"data-path="5-go-command.html"><a href="5-go-command.html">A.5. Command</a></li><li class="chapter"data-level="1.2.6"data-path="6-hello-world.html"><a href="6-hello-world.html">A.6. Program Pertama: Hello World</a></li><li class="chapter"data-level="1.2.7"data-path="7-komentar.html"><a href="7-komentar.html">A.7. Komentar</a></li><li class="chapter"data-level="1.2.8"data-path="8-variabel.html"><a href="8-variabel.html">A.8. Variabel</a></li><li class="chapter"data-level="1.2.9"data-path="9-tipe-data.html"><a href="9-tipe-data.html">A.9. Tipe Data</a></li><li class="chapter"data-level="1.2.10"data-path="10-konstanta.html"><a href="10-konstanta.html">A.10. Konstanta</a></li><li class="chapter"data-level="1.2.11"data-path="11-operator.html"><a href="11-operator.html">A.11. Operator</a></li><li class="chapter"data-level="1.2.12"data-path="12-seleksi-kondisi.html"><a href="12-seleksi-kondisi.html">A.12. Seleksi Kondisi</a></li><li class="chapter"data-level="1.2.13"data-path="13-perulangan.html"><a href="13-perulangan.html">A.13. Perulangan</a></li><li class="chapter"data-level="1.2.14"data-path="14-array.html"><a href="14-array.html">A.14. Array</a></li><li class="chapter"data-level="1.2.15"data-path="15-slice.html"><a href="15-slice.html">A.15. Slice</a></li><li class="chapter"data-level="1.2.16"data-path="16-map.html"><a href="16-map.html">A.16. Map</a></li><li class="chapter"data-level="1.2.17"data-path="17-fungsi.html"><a href="17-fungsi.html">A.17. Fungsi</a></li><li class="chapter"data-level="1.2.18"data-path="18-fungsi-multiple-return.html"><a href="18-fungsi-multiple-return.html">A.18. Fungsi Multiple Return</a></li><li class="chapter"data-level="1.2.19"data-path="19-fungsi-variadic.html"><a href="19-fungsi-variadic.html">A.19. Fungsi Variadic</a></li><li class="chapter"data-level="1.2.20"data-path="20-fungsi-closure.html"><a href="20-fungsi-closure.html">A.20. Fungsi Closure</a></li><li class="chapter"data-level="1.2.21"data-path="21-fungsi-sebagai-parameter.html"><a href="21-fungsi-sebagai-parameter.html">A.21. Fungsi Sebagai parameter</a></li><li class="chapter"data-level="1.2.22"data-path="22-pointer.html"><a href="22-pointer.html">A.22. Pointer</a></li><li class="chapter"data-level="1.2.23"data-path="23-struct.html"><a href="23-struct.html">A.23. Struct</a></li><li class="chapter"data-level="1.2.24"data-path="24-method.html"><a href="24-method.html">A.24. Method</a></li><li class="chapter"data-level="1.2.25"data-path="25-properti-public-dan-private.html"><a href="25-properti-public-dan-private.html">A.25. Property Public & Private</a></li><li class="chapter"data-level="1.2.26"data-path="26-interface.html"><a href="26-interface.html">A.26. Interface</a></li><li class="chapter"data-level="1.2.27"data-path="27-interface-kosong.html"><a href="27-interface-kosong.html">A.27. Interface Kosong</a></li><li class="chapter"data-level="1.2.28"data-path="28-reflect.html"><a href="28-reflect.html">A.28. Reflect</a></li><li class="chapter"data-level="1.2.29"data-path="29-goroutine.html"><a href="29-goroutine.html">A.29. Goroutine</a></li><li class="chapter"data-level="1.2.30"data-path="30-channel.html"><a href="30-channel.html">A.30. Channel</a></li><li class="chapter"data-level="1.2.31"data-path="31-buffered-channel.html"><a href="31-buffered-channel.html">A.31. Buffered Channel</a></li><li class="chapter"data-level="1.2.32"data-path="32-channel-select.html"><a href="32-channel-select.html">A.32. Channel - Select</a></li><li class="chapter"data-level="1.2.33"data-path="33-channel-range-close.html"><a href="33-channel-range-close.html">A.33. Channel - Range & Close</a></li><li class="chapter"data-level="1.2.34"data-path="34-channel-timeout.html"><a href="34-channel-timeout.html">A.34. Channel - Timeout</a></li><li class="chapter"data-level="1.2.35"data-path="35-defer-exit.html"><a href="35-defer-exit.html">A.35. Defer & Exit</a></li><li class="chapter"data-level="1.2.36"data-path="36-error-panic-recover.html"><a href="36-error-panic-recover.html">A.36. Error, Panic, & Recover</a></li><li class="chapter"data-level="1.2.37"data-path="37-string-format.html"><a href="37-string-format.html">A.37. Layout Format String</a></li><li class="chapter"data-level="1.2.38"data-path="38-time.html"><a href="38-time.html">A.38. Time, Parsing Time, & Format Time</a></li><li class="chapter"data-level="1.2.39"data-path="39-timer.html"><a href="39-timer.html">A.39. Timer</a></li><li class="chapter"data-level="1.2.40"data-path="40-data-type-conversion.html"><a href="40-data-type-conversion.html">A.40. Konversi Antar Tipe Data</a></li><li class="chapter"data-level="1.2.41"data-path="41-strings.html"><a href="41-strings.html">A.41. Fungsi String</a></li><li class="chapter"data-level="1.2.42"data-path="42-regex.html"><a href="42-regex.html">A.42. Regex</a></li><li class="chapter"data-level="1.2.43"data-path="43-encoding-base64.html"><a href="43-encoding-base64.html">A.43. Encode - Decode Base64</a></li><li class="chapter"data-level="1.2.44"data-path="44-hash-sha1.html"><a href="44-hash-sha1.html">A.44. Hash Sha1</a></li><li class="chapter"data-level="1.2.45"data-path="45-command-line-args-flag.html"><a href="45-command-line-args-flag.html">A.45. Arguments & Flag</a></li><li class="chapter"data-level="1.2.46"data-path="46-exec.html"><a href="46-exec.html">A.46. Exec</a></li><li class="chapter"data-level="1.2.47"data-path="47-file.html"><a href="47-file.html">A.47. File</a></li><li class="chapter"data-level="1.2.48"data-path="48-web.html"><a href="48-web.html">A.48. Web</a></li><li class="chapter"data-level="1.2.49"data-path="49-url-parsing.html"><a href="49-url-parsing.html">A.49. URL Parsing</a></li><li class="chapter"data-level="1.2.50"data-path="50-json.html"><a href="50-json.html">A.50. JSON</a></li><li class="chapter"data-level="1.2.51"data-path="51-web-json-api.html"><a href="51-web-json-api.html">A.51. Web JSON API</a></li><li class="chapter"data-level="1.2.52"data-path="52-http-request.html"><a href="52-http-request.html">A.52. HTTP Request</a></li><li class="chapter"data-level="1.2.53"data-path="53-sql.html"><a href="53-sql.html">A.53. SQL</a></li><li class="chapter"data-level="1.2.54"data-path="54-mongodb.html"><a href="54-mongodb.html">A.54. NoSQL MongoDB</a></li><li class="chapter"data-level="1.2.55"data-path="55-unit-test.html"><a href="55-unit-test.html">A.55. Unit Test</a></li><li class="chapter"data-level="1.2.56"data-path="56-waitgroup.html"><a href="56-waitgroup.html">A.56. WaitGroup</a></li><li class="chapter"data-level="1.2.57"data-path="57-mutex.html"><a href="57-mutex.html">A.57. Mutex</a></li><li class="chapter"data-level="1.2.58"data-path="A-58-go-vendoring.html"><a href="A-58-go-vendoring.html">A.58. Go Vendoring</a></li><li class="chapter"data-level="1.2.59"data-path="A-59-go-dep.html"><a href="A-59-go-dep.html">A.59. Dep - Go Dependency Management Tool</a></li><li class="chapter"data-level="1.2.60"data-path="A-60-go-modules.html"><a href="A-60-go-modules.html">A.60. Go Modules</a></li></ul></li><li class="chapter"data-level="1.3"><span>B. Pemrograman Web Golang Dasar</span><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="B-1-golang-web-hello-world.html"><a href="B-1-golang-web-hello-world.html">B.1. Golang Web App: Hello World</a></li><li class="chapter"data-level="1.3.2"data-path="B-2-routing-http-handlefunc.html"><a href="B-2-routing-http-handlefunc.html">B.2. Routing http.HandleFunc</a></li><li class="chapter"data-level="1.3.3"data-path="B-3-routing-static-assets.html"><a href="B-3-routing-static-assets.html">B.3. Routing Static Assets</a></li><li class="chapter"data-level="1.3.4"data-path="B-4-template-render-html.html"><a href="B-4-template-render-html.html">B.4. Template: Render HTML Template</a></li><li class="chapter"data-level="1.3.5"data-path="B-5-template-render-partial-html.html"><a href="B-5-template-render-partial-html.html">B.5. Template: Render Partial HTML Template</a></li><li class="chapter"data-level="1.3.6"data-path="B-6-template-actions-variables.html"><a href="B-6-template-actions-variables.html">B.6. Template: Actions & Variables</a></li><li class="chapter"data-level="1.3.7"data-path="B-7-template-functions.html"><a href="B-7-template-functions.html">B.7. Template: Functions</a></li><li class="chapter"data-level="1.3.8"data-path="B-8-template-custom-functions.html"><a href="B-8-template-custom-functions.html">B.8. Template: Custom Functions</a></li><li class="chapter"data-level="1.3.9"data-path="B-9-render-specific-html-template.html"><a href="B-9-render-specific-html-template.html">B.9. Template: Render Specific HTML Template</a></li><li class="chapter"data-level="1.3.10"data-path="B-10-render-html-string.html"><a href="B-10-render-html-string.html">B.10. Template: Render HTML String</a></li><li class="chapter"data-level="1.3.11"data-path="B-11-http-method.html"><a href="B-11-http-method.html">B.11. HTTP Method: POST & GET</a></li><li class="chapter"data-level="1.3.12"data-path="B-12-form-value.html"><a href="B-12-form-value.html">B.12. Form Value</a></li><li class="chapter"data-level="1.3.13"data-path="B-13-form-upload-file.html"><a href="B-13-form-upload-file.html">B.13. Form Upload File</a></li><li class="chapter"data-level="1.3.14"data-path="B-14-ajax-json-payload.html"><a href="B-14-ajax-json-payload.html">B.14. AJAX JSON Payload</a></li><li class="chapter"data-level="1.3.15"data-path="B-15-ajax-json-response.html"><a href="B-15-ajax-json-response.html">B.15. AJAX JSON Response</a></li><li class="chapter"data-level="1.3.16"data-path="B-16-ajax-multi-upload.html"><a href="B-16-ajax-multi-upload.html">B.16. AJAX Multiple File Upload</a></li><li class="chapter"data-level="1.3.17"data-path="B-17-download-file.html"><a href="B-17-download-file.html">B.17. Download File</a></li><li class="chapter"data-level="1.3.18"data-path="B-18-http-basic-auth.html"><a href="B-18-http-basic-auth.html">B.18. HTTP Basic Auth</a></li><li class="chapter active"data-level="1.3.19"data-path="B-19-middleware-using-http-handler.html"><a href="B-19-middleware-using-http-handler.html">B.19. Middleware http.Handler</a></li><li class="chapter"data-level="1.3.20"data-path="B-20-custom-mux-multiplexer.html"><a href="B-20-custom-mux-multiplexer.html">B.20. Custom Multiplexer</a></li><li class="chapter"data-level="1.3.21"data-path="B-21-cookie.html"><a href="B-21-cookie.html">B.21. HTTP Cookie</a></li><li class="chapter"data-level="1.3.22"data-path="B-22-configuration-file.html"><a href="B-22-configuration-file.html">B.22. Configuration File</a></li></ul></li><li class="chapter"data-level="1.4"><span>C. Pemrograman Web Golang Lanjut</span><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="C-1-echo-routing.html"><a href="C-1-echo-routing.html">C.1. Echo Framework & Routing</a></li><li class="chapter"data-level="1.4.2"data-path="C-2-parsing-http-request-payload-echo.html"><a href="C-2-parsing-http-request-payload-echo.html">C.2. Parsing HTTP Request Payload (Echo)</a></li><li class="chapter"data-level="1.4.3"data-path="C-3-http-request-payload-validation.html"><a href="C-3-http-request-payload-validation.html">C.3. HTTP Request Payload Validation (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.4"data-path="C-4-http-error-handling.html"><a href="C-4-http-error-handling.html">C.4. HTTP Error Handling (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.5"data-path="C-5-echo-template-rendering.html"><a href="C-5-echo-template-rendering.html">C.5. Template Rendering in Echo</a></li><li class="chapter"data-level="1.4.6"data-path="C-6-advanced-middleware-and-logging.html"><a href="C-6-advanced-middleware-and-logging.html">C.6. Advanced Middleware & Logging (Logrus, Echo Logger)</a></li><li class="chapter"data-level="1.4.7"data-path="C-7-flag-parser.html"><a href="C-7-flag-parser.html">C.7. CLI Flag Parser (Kingpin)</a></li><li class="chapter"data-level="1.4.8"data-path="C-8-advanced-configuration-file.html"><a href="C-8-advanced-configuration-file.html">C.8. Advanced Configuration File (Viper)</a></li><li class="chapter"data-level="1.4.9"data-path="C-9-securecookie.html"><a href="C-9-securecookie.html">C.9. Secure Cookie (Gorilla Securecookie)</a></li><li class="chapter"data-level="1.4.10"data-path="C-10-session.html"><a href="C-10-session.html">C.10. Session (Gorilla Session)</a></li><li class="chapter"data-level="1.4.11"data-path="C-12-cors-preflight-request.html"><a href="C-12-cors-preflight-request.html">C.12. CORS & Preflight Request</a></li><li class="chapter"data-level="1.4.12"data-path="C-13-csrf.html"><a href="C-13-csrf.html">C.13. CSRF</a></li><li class="chapter"data-level="1.4.13"data-path="C-14-secure-middleware.html"><a href="C-14-secure-middleware.html">C.14. Secure Middleware</a></li><li class="chapter"data-level="1.4.14"data-path="C-15-http-gzip-compression.html"><a href="C-15-http-gzip-compression.html">C.15. HTTP Gzip Compression (gziphandler)</a></li><li class="chapter"data-level="1.4.15"data-path="C-16-send-email.html"><a href="C-16-send-email.html">C.16. Send Mail (net/smtp, Gomail v2)</a></li><li class="chapter"data-level="1.4.16"data-path="C-17-read-write-excel-xlsx-file.html"><a href="C-17-read-write-excel-xlsx-file.html">C.17. Read & Write Excel XLSX File (Excelize)</a></li><li class="chapter"data-level="1.4.17"data-path="C-18-write-pdf-file.html"><a href="C-18-write-pdf-file.html">C.18. Write PDF File (gofpdf)</a></li><li class="chapter"data-level="1.4.18"data-path="C-19-convert-html-to-pdf.html"><a href="C-19-convert-html-to-pdf.html">C.19. Convert HTML to PDF (go-wkhtmltopdf)</a></li><li class="chapter"data-level="1.4.19"data-path="C-20-scraping-parsing-html.html"><a href="C-20-scraping-parsing-html.html">C.20. Scraping & Parsing HTML (goquery)</a></li><li class="chapter"data-level="1.4.20"data-path="C-21-xml-parser.html"><a href="C-21-xml-parser.html">C.21. Parse & Generate XML (etree)</a></li><li class="chapter"data-level="1.4.21"data-path="C-22-https-tls.html"><a href="C-22-https-tls.html">C.22. HTTPS/TLS Web Server</a></li><li class="chapter"data-level="1.4.22"data-path="C-23-http2-server-push.html"><a href="C-23-http2-server-push.html">C.23. HTTP/2 & HTTP/2 Server Push</a></li><li class="chapter"data-level="1.4.23"data-path="C-24-client-http-request.html"><a href="C-24-client-http-request.html">C.24. Client HTTP Request</a></li><li class="chapter"data-level="1.4.24"data-path="C-25-secure-insecure-client-http-request.html"><a href="C-25-secure-insecure-client-http-request.html">C.25. Secure & Insecure Client HTTP Request</a></li><li class="chapter"data-level="1.4.25"data-path="C-26-golang-ftp.html"><a href="C-26-golang-ftp.html">C.26. FTP</a></li><li class="chapter"data-level="1.4.26"data-path="C-27-golang-ssh-sftp.html"><a href="C-27-golang-ssh-sftp.html">C.27. SSH & SFTP</a></li><li class="chapter"data-level="1.4.27"data-path="C-28-golang-web-socket.html"><a href="C-28-golang-web-socket.html">C.28. Web Socket: Chatting App</a></li><li class="chapter"data-level="1.4.28"data-path="C-29-golang-protobuf-implementation.html"><a href="C-29-golang-protobuf-implementation.html">C.29. Protobuf</a></li><li class="chapter"data-level="1.4.29"data-path="C-30-golang-grpc-protobuf.html"><a href="C-30-golang-grpc-protobuf.html">C.30. gRPC + Protobuf</a></li><li class="chapter"data-level="1.4.30"data-path="C-31-golang-context.html"><a href="C-31-golang-context.html">C.31. Context: Value, Timeout, & Cancellation</a></li><li class="chapter"data-level="1.4.31"data-path="C-32-golang-jwt.html"><a href="C-32-golang-jwt.html">C.32. JSON Web Token (JWT)</a></li></ul></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><a href=".">B.19. Middleware http.Handler</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="b19-middleware-httphandler">B.19. Middleware <code>http.Handler</code></h1><p>Pada bab ini, kita akan belajar penggunaan interface <code>http.Handler</code> untuk implementasi custom middleware. Kita akan menggunakan sample proyek pada bab sebelumnya <a href="1-17-http-basic-auth.html">A18 - HTTP Basic Auth</a> sebagai dasar bahan pembahasan bab ini.</p><blockquote><p>Apa itu middleware? Istilah middleware berbeda-beda di tiap bahasa/framework. NodeJS dan Rails ada istilah middleware. Pada pemrograman Java Enterprise, istilah filters digunakan. Pada C# istilahnya adalah delegate handlers. Definisi dari middleware sendiri versi penulis, sebuah blok kode yang dipanggil sebelum ataupun sesudah http request di proses.</p></blockquote><p>Di bab sebelumnya, kalau dilihat, ada beberapa proses yang dijalankan dalam handler rute <code>/student</code>, yaitu pengecekan otentikasi dan pengecekan method. Misalnya terdapat rute lagi, maka dua validasi tersebut juga harus dipanggil lagi dalam handlernya.</p><pre><code class="lang-go"><span class="hljs-keyword">func</span> ActionStudent(w http.ResponseWriter, r *http.Request) {
    <span class="hljs-keyword">if</span> !Auth(w, r) { <span class="hljs-keyword">return</span> }
    <span class="hljs-keyword">if</span> !AllowOnlyGET(w, r) { <span class="hljs-keyword">return</span> }

    <span class="hljs-comment">// ...</span>
}
</code></pre><p>Jika ada banyak rute, apa yang harus kita lakukan? salah satu solusi yang bisa digunakan adalah dengan memanggil fungsi <code>Auth()</code> dan <code>AllowOnlyGet()</code> di semua handler rute yang ada. Namun jelasnya ini bukan best practice. Dan juga belum tentu di tiap rute hanya ada dua validasi ini, bisa saja ada lebih banyak proses, misalnya pengecekan csrf, authorization, dan lainnya.</p><p>Solusi dari masalah tersebut adalah, mengkonversi fungsi-fungsi di atas menjadi middleware.</p><h2 id="b191-interface-httphandler">B.19.1. Interface <code>http.Handler</code></h2><p>Interface <code>http.Handler</code> merupakan tipe data paling populer di golang untuk keperluan manajemen middleware. Struct yang mengimplementasikan interface ini diwajibkan memilik method dengan skema <code>ServeHTTP(ResponseWriter, *Request)</code>.</p><p>Di golang sendiri objek utama untuk keperluan routing yaitu <code>mux</code> atau multiplexer, adalah mengimplementasikan interface <code>http.Handler</code> ini.</p><p>Dengan memanfaatkan interface ini, kita akan membuat beberapa middleware. Fungsi pengecekan otentikasi dan pengecekan method akan kita ubah menjadi middleware terpisah.</p><h2 id="b192-persiapan">B.19.2. Persiapan</h2><p>OK, mari kita praktekan. Pertama duplikat folder projek sebelumnya sebagai folder proyek baru. Lalu pada <code>main.go</code>, ubah isi fungsi <code>ActionStudent</code> dan <code>main</code>.</p><ul><li><p>Fungsi<code>ActionStudent()</code></p><pre><code class="lang-go"> <span class="hljs-keyword">func</span> ActionStudent(w http.ResponseWriter, r *http.Request) {
     <span class="hljs-keyword">if</span> id := r.URL.Query().Get(<span class="hljs-string">&quot;id&quot;</span>); id != <span class="hljs-string">&quot;&quot;</span> {
         OutputJSON(w, SelectStudent(id))
         <span class="hljs-keyword">return</span>
     }

     OutputJSON(w, GetStudents())
 }
</code></pre></li><li><p>Fungsi <code>main()</code></p><pre><code class="lang-go"> <span class="hljs-keyword">func</span> main() {
     mux := http.DefaultServeMux

     mux.HandleFunc(<span class="hljs-string">&quot;/student&quot;</span>, ActionStudent)

     <span class="hljs-keyword">var</span> handler http.Handler = mux
     handler = MiddlewareAuth(handler)
     handler = MiddlewareAllowOnlyGet(handler)

     server := <span class="hljs-built_in">new</span>(http.Server)
     server.Addr = <span class="hljs-string">&quot;:9000&quot;</span>
     server.Handler = handler

     fmt.Println(<span class="hljs-string">&quot;server started at localhost:9000&quot;</span>)
     server.ListenAndServe()
 }
</code></pre></li></ul><p>Perubahan pada kode <code>ActionStudent()</code> adalah, pengecekan basic auth dan pengecekan method dihapus. Selain itu di fungsi <code>main()</code> juga terdapat cukup banyak perubahan, yang detailnya akan kita bahas di bawah ini.</p><h2 id="b193-mux--multiplexer">B.19.3. Mux / Multiplexer</h2><p>Di golang, mux (kependekan dari multiplexer) adalah router. Semua routing pasti dilakukan lewat objek mux ini.</p><p>Apa benar? routing <code>http.HandleFunc()</code> sepertinya tidak menggunakan mux? Sebenarnya routing tersebut juga menggunakan mux. Golang memiliki default objek mux yaitu <code>http.DefaultServeMux</code>. Routing yang langsung dilakukan dari fungsi <code>HandleFunc()</code> milik package <code>net/http</code> sebenarnya mengarah ke method default mux <code>http.DefaultServeMux.HandleFunc()</code>. Jadi kedua gaya routing berikut hasilnya adalah sama. Silakan lihat kode berikut untuk perbandingan.</p><pre><code class="lang-go">http.HandleFunc(<span class="hljs-string">&quot;/student&quot;</span>, ActionStudent)

<span class="hljs-comment">// vs</span>

mux := http.DefaultServeMux
mux.HandleFunc(<span class="hljs-string">&quot;/student&quot;</span>, ActionStudent)
</code></pre><p>Mux sendiri adalah bentuk nyata struct yang mengimplementasikan interface <code>http.Handler</code>. Untuk lebih jelasnya silakan baca dokumentasi package net/http di <a href="https://golang.org/pkg/net/http/#Handle"target="_blank">https://golang.org/pkg/net/http/#Handle</a>.</p><p>Kembali ke pembahasan source code. Di kode setelah routing, bisa dilihat objek <code>mux</code> ditampung ke variabel baru bertipe <code>http.Handler</code>. Seperti ini adalah valid karena memang struct multiplexer memenuhi kriteria interface <code>http.Handler</code>, yaitu memiliki method <code>ServeHTTP()</code>.</p><p>Lalu dari objek <code>handler</code> tersebut, ke-dua middleware dipanggil dengan parameter adalah objek <code>handler</code> itu sendiri dan nilai baliknya ditampung pada objek yang sama.</p><pre><code class="lang-go"><span class="hljs-keyword">var</span> handler http.Handler = mux
handler = MiddlewareAuth(handler)
handler = MiddlewareAllowOnlyGet(handler)
</code></pre><p>Fungsi <code>MiddlewareAuth()</code> dan <code>MiddlewareAllowOnlyGet()</code> adalah middleware yang akan kita buat setelah ini. Cara registrasi middleware yang paling populer adalah dengan memanggilnya secara sekuensial atau berurutan, seperti pada kode di atas.</p><ul><li><code>MiddlewareAuth()</code> bertugas untuk melakukan pengencekan credentials, basic auth.</li><li><code>MiddlewareAllowOnlyGet()</code> bertugas untuk melakukan pengecekan method.</li></ul><blockquote><p>Silakan lihat source code beberapa library middleware yang sudah terkenal seperti gorilla, gin-contrib, echo middleware, dan lainnya; kesemuanya metode implementasi middleware-nya adalah sama, atau paling tidak mirip. Point plus nya, beberapa diantara library tersebut mudah diintegrasikan dan compatible satu sama lain.</p></blockquote><p>Kedua middleware yang akan kita buat tersebut mengembalikan fungsi bertipe <code>http.Handler</code>. Eksekusi middleware sendiri terjadi pada saat ada http request masuk.</p><p>Setelah semua middleware diregistrasi. Masukan objek <code>handler</code> ke property <code>.Handler</code> milik server.</p><pre><code class="lang-go">server := <span class="hljs-built_in">new</span>(http.Server)
server.Addr = <span class="hljs-string">&quot;:9000&quot;</span>
server.Handler = handler
</code></pre><h2 id="b193-pembuatan-middleware">B.19.3. Pembuatan Middleware</h2><p>Di dalam <code>middleware.go</code> ubah fungsi <code>Auth()</code> (hasil salinan projek pada bab sebelumnya) menjadi fungsi <code>MiddlewareAuth()</code>. Parameternya objek bertipe <code>http.Handler</code>, dan nilai baliknya juga sama.</p><pre><code class="lang-go"><span class="hljs-keyword">func</span> MiddlewareAuth(next http.Handler) http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        username, password, ok := r.BasicAuth()
        <span class="hljs-keyword">if</span> !ok {
            w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">`something went wrong`</span>))
            <span class="hljs-keyword">return</span>
        }

        isValid := (username == USERNAME) &amp;&amp; (password == PASSWORD)
        <span class="hljs-keyword">if</span> !isValid {
            w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">`wrong username/password`</span>))
            <span class="hljs-keyword">return</span>
        }

        next.ServeHTTP(w, r)
    })
}
</code></pre><p>Idealnya fungsi middleware harus mengembalikan struct yang implements <code>http.Handler</code>. Beruntungnya, golang sudah menyiapkan fungsi ajaib untuk mempersingkat pembuatan struct-yang-implemenets-<code>http.Handler</code>. Fungsi tersebut adalah <code>http.HandlerFunc</code>, cukup bungkus callback <code>func(http.ResponseWriter,*http.Request)</code> sebagai tipe <code>http.HandlerFunc</code> dan semuanya beres.</p><p>Isi dari <code>MiddlewareAuth()</code> sendiri adalah pengecekan basic auth, sama seperti pada bab sebelumnya.</p><p>Tak lupa, ubah juga <code>AllowOnlyGet()</code> menjadi <code>MiddlewareAllowOnlyGet()</code>.</p><pre><code class="lang-go"><span class="hljs-keyword">func</span> MiddlewareAllowOnlyGet(next http.Handler) http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-keyword">func</span>(w http.ResponseWriter, r *http.Request) {
        <span class="hljs-keyword">if</span> r.Method != <span class="hljs-string">&quot;GET&quot;</span> {
            w.Write([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;Only GET is allowed&quot;</span>))
            <span class="hljs-keyword">return</span>
        }

        next.ServeHTTP(w, r)
    })
}
</code></pre><h2 id="b194-testing">B.19.4. Testing</h2><p>Jalankan aplikasi.</p><p><img alt="Run the server"src="images/B.18_2_run_server.png"></p><p>Lalu test menggunakan <code>curl</code>, hasilnya adalah sama dengan pada bab sebelumnya.</p><p><img alt="Consume API"src="images/B.18_3_test_api.png"></p><p>Dibanding metode pada bab sebelumnya, dengan teknik ini kita bisa sangat mudah mengontrol lalu lintas routing aplikasi, karena semua rute pasti melewati middleware terlebih dahulu sebelum sampai ke tujuan. Cukup maksimalkan middleware tersebut tanpa menggangu fungsi callback masing-masing rute.</p></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title">results matching ""</h1></div><div class="no-results"><h1 class="search-results-title">No results matching ""</h1></div></div></div></div></div></div><a href="B-18-http-basic-auth.html"class="navigation navigation-prev"aria-label="Previous page: B.18. HTTP Basic Auth"></a><a href="B-20-custom-mux-multiplexer.html"class="navigation navigation-next"aria-label="Next page: B.20. Custom Multiplexer"></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"B.19. Middleware http.Handler",level:"1.3.19",depth:2,next:{title:"B.20. Custom Multiplexer",level:"1.3.20",depth:2,path:"B-20-custom-mux-multiplexer.md",ref:"B-20-custom-mux-multiplexer.md",articles:[]},previous:{title:"B.18. HTTP Basic Auth",level:"1.3.18",depth:2,path:"B-18-http-basic-auth.md",ref:"B-18-http-basic-auth.md",articles:[]},dir:"ltr"},config:{plugins:["ga","html-minifier","disqus","meta","sitemap","scripts"],styles:{website:"styles/website.css"},pluginsConfig:{disqus:{useIdentifier:!1,shortName:"dasarpemrogramangolang"},meta:{content:"",data:[{name:"google-site-verification",content:"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{name:"og:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{name:"twitter:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],name:""},scripts:{files:[]},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!0,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},highlight:{},sitemap:{hostname:"https://dasarpemrogramangolang.novalagung.com/"},ga:{configuration:"auto",token:"UA-27602984-29"},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1}},theme:"default",lunr:{maxIndexSize:1e9},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},gitbook:"*"},file:{path:"B-19-middleware-using-http-handler.md",mtime:"2018-10-01T03:00:53.703Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2018-12-07T00:59:33.615Z"},basePath:".",book:{language:""}})})</script></div><script src="gitbook/gitbook.js"></script><script src="gitbook/theme.js"></script><script src="gitbook/gitbook-plugin-ga/plugin.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="gitbook/gitbook-plugin-search/search-engine.js"></script><script src="gitbook/gitbook-plugin-search/search.js"></script><script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script></body></html>