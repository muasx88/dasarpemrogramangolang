<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>C.29. Golang Protobuf - Dasar Pemrograman Golang</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="gitbook/style.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="styles/website.css"rel="stylesheet"><meta content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"name="google-site-verification"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="og:image"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="twitter:image"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="C-30-golang-grpc-protobuf.html"rel="next"/><link href="C-28-golang-web-socket.html"rel="prev"/></head><body><div class="book"><div class="book-summary"><div role="search"id="book-search-input"><input placeholder="Type to search"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="./"><a href="./">Introduction</a></li><li class="chapter"data-level="1.2"><span>A. Pemrograman Golang Dasar</span><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="1-berkenalan-dengan-golang.html"><a href="1-berkenalan-dengan-golang.html">A.1. Berkenalan Dengan Golang</a></li><li class="chapter"data-level="1.2.2"data-path="2-instalasi-golang.html"><a href="2-instalasi-golang.html">A.2. Instalasi Golang</a></li><li class="chapter"data-level="1.2.3"data-path="3-gopath-dan-workspace.html"><a href="3-gopath-dan-workspace.html">A.3. GOPATH Dan Workspace</a></li><li class="chapter"data-level="1.2.4"data-path="4-instalasi-editor.html"><a href="4-instalasi-editor.html">A.4. Instalasi Editor</a></li><li class="chapter"data-level="1.2.5"data-path="5-go-command.html"><a href="5-go-command.html">A.5. Command</a></li><li class="chapter"data-level="1.2.6"data-path="6-hello-world.html"><a href="6-hello-world.html">A.6. Program Pertama: Hello World</a></li><li class="chapter"data-level="1.2.7"data-path="7-komentar.html"><a href="7-komentar.html">A.7. Komentar</a></li><li class="chapter"data-level="1.2.8"data-path="8-variabel.html"><a href="8-variabel.html">A.8. Variabel</a></li><li class="chapter"data-level="1.2.9"data-path="9-tipe-data.html"><a href="9-tipe-data.html">A.9. Tipe Data</a></li><li class="chapter"data-level="1.2.10"data-path="10-konstanta.html"><a href="10-konstanta.html">A.10. Konstanta</a></li><li class="chapter"data-level="1.2.11"data-path="11-operator.html"><a href="11-operator.html">A.11. Operator</a></li><li class="chapter"data-level="1.2.12"data-path="12-seleksi-kondisi.html"><a href="12-seleksi-kondisi.html">A.12. Seleksi Kondisi</a></li><li class="chapter"data-level="1.2.13"data-path="13-perulangan.html"><a href="13-perulangan.html">A.13. Perulangan</a></li><li class="chapter"data-level="1.2.14"data-path="14-array.html"><a href="14-array.html">A.14. Array</a></li><li class="chapter"data-level="1.2.15"data-path="15-slice.html"><a href="15-slice.html">A.15. Slice</a></li><li class="chapter"data-level="1.2.16"data-path="16-map.html"><a href="16-map.html">A.16. Map</a></li><li class="chapter"data-level="1.2.17"data-path="17-fungsi.html"><a href="17-fungsi.html">A.17. Fungsi</a></li><li class="chapter"data-level="1.2.18"data-path="18-fungsi-multiple-return.html"><a href="18-fungsi-multiple-return.html">A.18. Fungsi Multiple Return</a></li><li class="chapter"data-level="1.2.19"data-path="19-fungsi-variadic.html"><a href="19-fungsi-variadic.html">A.19. Fungsi Variadic</a></li><li class="chapter"data-level="1.2.20"data-path="20-fungsi-closure.html"><a href="20-fungsi-closure.html">A.20. Fungsi Closure</a></li><li class="chapter"data-level="1.2.21"data-path="21-fungsi-sebagai-parameter.html"><a href="21-fungsi-sebagai-parameter.html">A.21. Fungsi Sebagai parameter</a></li><li class="chapter"data-level="1.2.22"data-path="22-pointer.html"><a href="22-pointer.html">A.22. Pointer</a></li><li class="chapter"data-level="1.2.23"data-path="23-struct.html"><a href="23-struct.html">A.23. Struct</a></li><li class="chapter"data-level="1.2.24"data-path="24-method.html"><a href="24-method.html">A.24. Method</a></li><li class="chapter"data-level="1.2.25"data-path="25-properti-public-dan-private.html"><a href="25-properti-public-dan-private.html">A.25. Property Public & Private</a></li><li class="chapter"data-level="1.2.26"data-path="26-interface.html"><a href="26-interface.html">A.26. Interface</a></li><li class="chapter"data-level="1.2.27"data-path="27-interface-kosong.html"><a href="27-interface-kosong.html">A.27. Interface Kosong</a></li><li class="chapter"data-level="1.2.28"data-path="28-reflect.html"><a href="28-reflect.html">A.28. Reflect</a></li><li class="chapter"data-level="1.2.29"data-path="29-goroutine.html"><a href="29-goroutine.html">A.29. Goroutine</a></li><li class="chapter"data-level="1.2.30"data-path="30-channel.html"><a href="30-channel.html">A.30. Channel</a></li><li class="chapter"data-level="1.2.31"data-path="31-buffered-channel.html"><a href="31-buffered-channel.html">A.31. Buffered Channel</a></li><li class="chapter"data-level="1.2.32"data-path="32-channel-select.html"><a href="32-channel-select.html">A.32. Channel - Select</a></li><li class="chapter"data-level="1.2.33"data-path="33-channel-range-close.html"><a href="33-channel-range-close.html">A.33. Channel - Range & Close</a></li><li class="chapter"data-level="1.2.34"data-path="34-channel-timeout.html"><a href="34-channel-timeout.html">A.34. Channel - Timeout</a></li><li class="chapter"data-level="1.2.35"data-path="35-defer-exit.html"><a href="35-defer-exit.html">A.35. Defer & Exit</a></li><li class="chapter"data-level="1.2.36"data-path="36-error-panic-recover.html"><a href="36-error-panic-recover.html">A.36. Error, Panic, & Recover</a></li><li class="chapter"data-level="1.2.37"data-path="37-string-format.html"><a href="37-string-format.html">A.37. Layout Format String</a></li><li class="chapter"data-level="1.2.38"data-path="38-time.html"><a href="38-time.html">A.38. Time, Parsing Time, & Format Time</a></li><li class="chapter"data-level="1.2.39"data-path="39-timer.html"><a href="39-timer.html">A.39. Timer</a></li><li class="chapter"data-level="1.2.40"data-path="40-data-type-conversion.html"><a href="40-data-type-conversion.html">A.40. Konversi Antar Tipe Data</a></li><li class="chapter"data-level="1.2.41"data-path="41-strings.html"><a href="41-strings.html">A.41. Fungsi String</a></li><li class="chapter"data-level="1.2.42"data-path="42-regex.html"><a href="42-regex.html">A.42. Regex</a></li><li class="chapter"data-level="1.2.43"data-path="43-encoding-base64.html"><a href="43-encoding-base64.html">A.43. Encode - Decode Base64</a></li><li class="chapter"data-level="1.2.44"data-path="44-hash-sha1.html"><a href="44-hash-sha1.html">A.44. Hash Sha1</a></li><li class="chapter"data-level="1.2.45"data-path="45-command-line-args-flag.html"><a href="45-command-line-args-flag.html">A.45. Arguments & Flag</a></li><li class="chapter"data-level="1.2.46"data-path="46-exec.html"><a href="46-exec.html">A.46. Exec</a></li><li class="chapter"data-level="1.2.47"data-path="47-file.html"><a href="47-file.html">A.47. File</a></li><li class="chapter"data-level="1.2.48"data-path="48-web.html"><a href="48-web.html">A.48. Web</a></li><li class="chapter"data-level="1.2.49"data-path="49-url-parsing.html"><a href="49-url-parsing.html">A.49. URL Parsing</a></li><li class="chapter"data-level="1.2.50"data-path="50-json.html"><a href="50-json.html">A.50. JSON</a></li><li class="chapter"data-level="1.2.51"data-path="51-web-json-api.html"><a href="51-web-json-api.html">A.51. Web JSON API</a></li><li class="chapter"data-level="1.2.52"data-path="52-http-request.html"><a href="52-http-request.html">A.52. HTTP Request</a></li><li class="chapter"data-level="1.2.53"data-path="53-sql.html"><a href="53-sql.html">A.53. SQL</a></li><li class="chapter"data-level="1.2.54"data-path="54-mongodb.html"><a href="54-mongodb.html">A.54. NoSQL MongoDB</a></li><li class="chapter"data-level="1.2.55"data-path="55-unit-test.html"><a href="55-unit-test.html">A.55. Unit Test</a></li><li class="chapter"data-level="1.2.56"data-path="56-waitgroup.html"><a href="56-waitgroup.html">A.56. WaitGroup</a></li><li class="chapter"data-level="1.2.57"data-path="57-mutex.html"><a href="57-mutex.html">A.57. Mutex</a></li><li class="chapter"data-level="1.2.58"data-path="A-58-go-vendoring.html"><a href="A-58-go-vendoring.html">A.58. Go Vendoring</a></li><li class="chapter"data-level="1.2.59"data-path="A-59-go-dep.html"><a href="A-59-go-dep.html">A.59. Dep - Go Dependency Management Tool</a></li><li class="chapter"data-level="1.2.60"data-path="A-60-go-modules.html"><a href="A-60-go-modules.html">A.60. Go Modules</a></li></ul></li><li class="chapter"data-level="1.3"><span>B. Pemrograman Web Golang Dasar</span><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="B-1-golang-web-hello-world.html"><a href="B-1-golang-web-hello-world.html">B.1. Golang Web App: Hello World</a></li><li class="chapter"data-level="1.3.2"data-path="B-2-routing-http-handlefunc.html"><a href="B-2-routing-http-handlefunc.html">B.2. Routing http.HandleFunc</a></li><li class="chapter"data-level="1.3.3"data-path="B-3-routing-static-assets.html"><a href="B-3-routing-static-assets.html">B.3. Routing Static Assets</a></li><li class="chapter"data-level="1.3.4"data-path="B-4-template-render-html.html"><a href="B-4-template-render-html.html">B.4. Template: Render HTML Template</a></li><li class="chapter"data-level="1.3.5"data-path="B-5-template-render-partial-html.html"><a href="B-5-template-render-partial-html.html">B.5. Template: Render Partial HTML Template</a></li><li class="chapter"data-level="1.3.6"data-path="B-6-template-actions-variables.html"><a href="B-6-template-actions-variables.html">B.6. Template: Actions & Variables</a></li><li class="chapter"data-level="1.3.7"data-path="B-7-template-functions.html"><a href="B-7-template-functions.html">B.7. Template: Functions</a></li><li class="chapter"data-level="1.3.8"data-path="B-8-template-custom-functions.html"><a href="B-8-template-custom-functions.html">B.8. Template: Custom Functions</a></li><li class="chapter"data-level="1.3.9"data-path="B-9-render-specific-html-template.html"><a href="B-9-render-specific-html-template.html">B.9. Template: Render Specific HTML Template</a></li><li class="chapter"data-level="1.3.10"data-path="B-10-render-html-string.html"><a href="B-10-render-html-string.html">B.10. Template: Render HTML String</a></li><li class="chapter"data-level="1.3.11"data-path="B-11-http-method.html"><a href="B-11-http-method.html">B.11. HTTP Method: POST & GET</a></li><li class="chapter"data-level="1.3.12"data-path="B-12-form-value.html"><a href="B-12-form-value.html">B.12. Form Value</a></li><li class="chapter"data-level="1.3.13"data-path="B-13-form-upload-file.html"><a href="B-13-form-upload-file.html">B.13. Form Upload File</a></li><li class="chapter"data-level="1.3.14"data-path="B-14-ajax-json-payload.html"><a href="B-14-ajax-json-payload.html">B.14. AJAX JSON Payload</a></li><li class="chapter"data-level="1.3.15"data-path="B-15-ajax-json-response.html"><a href="B-15-ajax-json-response.html">B.15. AJAX JSON Response</a></li><li class="chapter"data-level="1.3.16"data-path="B-16-ajax-multi-upload.html"><a href="B-16-ajax-multi-upload.html">B.16. AJAX Multiple File Upload</a></li><li class="chapter"data-level="1.3.17"data-path="B-17-download-file.html"><a href="B-17-download-file.html">B.17. Download File</a></li><li class="chapter"data-level="1.3.18"data-path="B-18-http-basic-auth.html"><a href="B-18-http-basic-auth.html">B.18. HTTP Basic Auth</a></li><li class="chapter"data-level="1.3.19"data-path="B-19-middleware-using-http-handler.html"><a href="B-19-middleware-using-http-handler.html">B.19. Middleware http.Handler</a></li><li class="chapter"data-level="1.3.20"data-path="B-20-custom-mux-multiplexer.html"><a href="B-20-custom-mux-multiplexer.html">B.20. Custom Multiplexer</a></li><li class="chapter"data-level="1.3.21"data-path="B-21-cookie.html"><a href="B-21-cookie.html">B.21. HTTP Cookie</a></li><li class="chapter"data-level="1.3.22"data-path="B-22-configuration-file.html"><a href="B-22-configuration-file.html">B.22. Configuration File</a></li></ul></li><li class="chapter"data-level="1.4"><span>C. Pemrograman Web Golang Lanjut</span><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="C-1-echo-routing.html"><a href="C-1-echo-routing.html">C.1. Echo Framework & Routing</a></li><li class="chapter"data-level="1.4.2"data-path="C-2-parsing-http-request-payload-echo.html"><a href="C-2-parsing-http-request-payload-echo.html">C.2. Parsing HTTP Request Payload (Echo)</a></li><li class="chapter"data-level="1.4.3"data-path="C-3-http-request-payload-validation.html"><a href="C-3-http-request-payload-validation.html">C.3. HTTP Request Payload Validation (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.4"data-path="C-4-http-error-handling.html"><a href="C-4-http-error-handling.html">C.4. HTTP Error Handling (Validator v9, Echo)</a></li><li class="chapter"data-level="1.4.5"data-path="C-5-echo-template-rendering.html"><a href="C-5-echo-template-rendering.html">C.5. Template Rendering in Echo</a></li><li class="chapter"data-level="1.4.6"data-path="C-6-advanced-middleware-and-logging.html"><a href="C-6-advanced-middleware-and-logging.html">C.6. Advanced Middleware & Logging (Logrus, Echo Logger)</a></li><li class="chapter"data-level="1.4.7"data-path="C-7-flag-parser.html"><a href="C-7-flag-parser.html">C.7. CLI Flag Parser (Kingpin)</a></li><li class="chapter"data-level="1.4.8"data-path="C-8-advanced-configuration-file.html"><a href="C-8-advanced-configuration-file.html">C.8. Advanced Configuration File (Viper)</a></li><li class="chapter"data-level="1.4.9"data-path="C-9-securecookie.html"><a href="C-9-securecookie.html">C.9. Secure Cookie (Gorilla Securecookie)</a></li><li class="chapter"data-level="1.4.10"data-path="C-10-session.html"><a href="C-10-session.html">C.10. Session (Gorilla Session)</a></li><li class="chapter"data-level="1.4.11"data-path="C-12-cors-preflight-request.html"><a href="C-12-cors-preflight-request.html">C.12. CORS & Preflight Request</a></li><li class="chapter"data-level="1.4.12"data-path="C-13-csrf.html"><a href="C-13-csrf.html">C.13. CSRF</a></li><li class="chapter"data-level="1.4.13"data-path="C-14-secure-middleware.html"><a href="C-14-secure-middleware.html">C.14. Secure Middleware</a></li><li class="chapter"data-level="1.4.14"data-path="C-15-http-gzip-compression.html"><a href="C-15-http-gzip-compression.html">C.15. HTTP Gzip Compression (gziphandler)</a></li><li class="chapter"data-level="1.4.15"data-path="C-16-send-email.html"><a href="C-16-send-email.html">C.16. Send Mail (net/smtp, Gomail v2)</a></li><li class="chapter"data-level="1.4.16"data-path="C-17-read-write-excel-xlsx-file.html"><a href="C-17-read-write-excel-xlsx-file.html">C.17. Read & Write Excel XLSX File (Excelize)</a></li><li class="chapter"data-level="1.4.17"data-path="C-18-write-pdf-file.html"><a href="C-18-write-pdf-file.html">C.18. Write PDF File (gofpdf)</a></li><li class="chapter"data-level="1.4.18"data-path="C-19-convert-html-to-pdf.html"><a href="C-19-convert-html-to-pdf.html">C.19. Convert HTML to PDF (go-wkhtmltopdf)</a></li><li class="chapter"data-level="1.4.19"data-path="C-20-scraping-parsing-html.html"><a href="C-20-scraping-parsing-html.html">C.20. Scraping & Parsing HTML (goquery)</a></li><li class="chapter"data-level="1.4.20"data-path="C-21-xml-parser.html"><a href="C-21-xml-parser.html">C.21. Parse & Generate XML (etree)</a></li><li class="chapter"data-level="1.4.21"data-path="C-22-https-tls.html"><a href="C-22-https-tls.html">C.22. HTTPS/TLS Web Server</a></li><li class="chapter"data-level="1.4.22"data-path="C-23-http2-server-push.html"><a href="C-23-http2-server-push.html">C.23. HTTP/2 & HTTP/2 Server Push</a></li><li class="chapter"data-level="1.4.23"data-path="C-24-client-http-request.html"><a href="C-24-client-http-request.html">C.24. Client HTTP Request</a></li><li class="chapter"data-level="1.4.24"data-path="C-25-secure-insecure-client-http-request.html"><a href="C-25-secure-insecure-client-http-request.html">C.25. Secure & Insecure Client HTTP Request</a></li><li class="chapter"data-level="1.4.25"data-path="C-26-golang-ftp.html"><a href="C-26-golang-ftp.html">C.26. FTP</a></li><li class="chapter"data-level="1.4.26"data-path="C-27-golang-ssh-sftp.html"><a href="C-27-golang-ssh-sftp.html">C.27. SSH & SFTP</a></li><li class="chapter"data-level="1.4.27"data-path="C-28-golang-web-socket.html"><a href="C-28-golang-web-socket.html">C.28. Web Socket: Chatting App</a></li><li class="chapter active"data-level="1.4.28"data-path="C-29-golang-protobuf-implementation.html"><a href="C-29-golang-protobuf-implementation.html">C.29. Protobuf</a></li><li class="chapter"data-level="1.4.29"data-path="C-30-golang-grpc-protobuf.html"><a href="C-30-golang-grpc-protobuf.html">C.30. gRPC + Protobuf</a></li><li class="chapter"data-level="1.4.30"data-path="C-31-golang-context.html"><a href="C-31-golang-context.html">C.31. Context: Value, Timeout, & Cancellation</a></li><li class="chapter"data-level="1.4.31"data-path="C-32-golang-jwt.html"><a href="C-32-golang-jwt.html">C.32. JSON Web Token (JWT)</a></li></ul></li><li><a href="https://www.gitbook.com"target="blank"class="gitbook-link">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><a href=".">C.29. Protobuf</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="c29-protobuf">C.29. Protobuf</h1><p>Pada bab ini kita akan belajar tentang penggunaan protobuf (Protocol Buffers) di golang.</p><p>Perlu diketahui, topik gRPC tidak kita pelajari pada bab ini, melainkan pada bab selanjutnya.</p><h2 id="c291-definisi">C.29.1. Definisi</h2><p>Protocol Buffers adalah metode untuk serialisasi data terstruktur, yang dibuat oleh Google. Protobuf cocok digunakan pada aplikasi yang berkomunikasi dengan aplikasi lain. Protobuf bisa dipakai di banyak platform, contoh: komunikasi antara aplikasi mobile iOS dan Golang Web Service, bisa menggunakan protobuf.</p><p>Protobuf hanya bertugas di bagian serialisasi data saja, untuk komunikasi antar service atau antar aplikasi sendiri menggunakan gRPC.</p><blockquote><p>gRPC adalah sebuah remote procedure call atau RPC yang dibuat oleh google. gRPC menggunakan HTTP/2 untuk komunikasinya, dan Protocol Buffers di bagian antarmuka-nya.</p></blockquote><p>Mungkin sampai sini masih terasa abstrak, membingungkan, dan muncul banyak pertanyaan mengenai apa dan untuk apa protobuf ini. Agar lebih mudah untuk dipahami, bayangkan sebuah aplikasi client yang mengkonsumsi data dari (RESTful) web service, dengan data dikirimkan dalam bentuk JSON.</p><p><img alt="HTTP JSON Analogy"src="images/C.29_1_http_json_analogy.png"></p><p>Di analogi sederhana di gambar, dijelaskan bahwa HTTP digunakan sebagai transport antara client dan server, dan JSON digunakan sebagai tipe data payload request dan response body type.</p><p>Arsitektur di atas (yang menggunakan http dan json) jika dikonversi ke bentuk gRPC dan protobuf, maka kurang lebih jadinya seperti gambar di bawah ini.</p><p><img alt="GRPC PROTOBUF Analogy"src="images/C.29_2_grpc_protobuf_analogy.png"></p><p>Cukup bisa dipahami bukan?</p><p>Sederhananya protobuf itu mirip seperti JSON atau XML, tapi lebih terstruktur. Perbedaannya adalah pada protobuf skema model harus didefinisikan di awal (<em>schema on write</em>).</p><p>Skema tersebut didefinisikan dalam file berekstensi <code>.proto</code>. Dari file tersebut di generate-lah file model sesuai bahasa yang dipilih. Misalkan bahasa yang digunakan adalah java, maka nantinya terbentuk pojo; misal bahasa adalah php nantinya class di-generate; jika bahasa golang maka struct di-generate, dan seterusnya.</p><blockquote><p>gRPC dan protobuf adalah salah satu pilihan terbaik untuk diterapkan pada aplikasi yang mengadopsi konsep microservices.</p></blockquote><h2 id="c292-instalasi">C.29.2. Instalasi</h2><p>Schema yang ditulis dalam <code>.proto</code> di-compile ke bentuk file sesuai bahasa yang dipilih. Dari sini jelasnya sebuah compiler dibutuhkan, maka dari itu protobuf harus install terlebih dahulu di lokal masing-masing. Compiler tersebut bernama <code>protoc</code> atau proto compiler.</p><p>Silakan merujuk ke <a href="http://google.github.io/proto-lens/installing-protoc.html"target="_blank">http://google.github.io/proto-lens/installing-protoc.html</a> untuk mengetahui cara instalasi <code>protoc</code> sesuai sistem operasi yang dibutuhkan.</p><p>Selain <code>protoc</code>, masih ada satu lagi yang perlu di install, yaitu protobuf runtime untuk golang (karena di sini kita menggunakan bahasa golang). Cara instalasinya cukup mudah:</p><pre><code class="lang-bash">$ go get -u github.com/golang/protobuf/proto
$ go get -u github.com/golang/protobuf/protoc-gen-go
</code></pre><blockquote><p>Protobuf runtime tersedia untuk banyak bahasa selain golang, selengkapnya silakan cek <a href="https://github.com/protocolbuffers/protobuf"target="_blank">https://github.com/protocolbuffers/protobuf</a>.</p></blockquote><h2 id="c293-pembuatan-file-proto">C.29.3. Pembuatan File <code>.Proto</code></h2><p>Siapkan satu buah folder dengan skema seperti berikut.</p><pre><code class="lang-bash">novalagung:src $ tree .
.
&#x2514;&#x2500;&#x2500; yourproject
    &#x251C;&#x2500;&#x2500; main.go
    &#x2514;&#x2500;&#x2500; model
        &#x251C;&#x2500;&#x2500; garage.proto
        &#x2514;&#x2500;&#x2500; user.proto
</code></pre><p>Folder <code>yourproject/model</code> berisikan file-file <code>.proto</code> (dua buah file proto didefinisikan). Dari kedua file di atas akan di-generate file model <code>.go</code> menggunakan command <code>protoc</code>. Nantinya generated file tersebut dipakai dalam <code>main.go</code>.</p><h4 id="file-userproto">&#x2022; File <code>user.proto</code></h4><p>OK, mari kita masuk ke bagian tulis-menulis kode. Buka file <code>user.proto</code>, tulis kode berikut.</p><pre><code class="lang-protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> model;

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">UserGender</span> </span>{
    UNDEFINED = <span class="hljs-number">0</span>;
    MALE = <span class="hljs-number">1</span>;
    FEMALE = <span class="hljs-number">2</span>;
}
</code></pre><p>Bahasa yang digunakan dalam file proto sangat minimalis, dan cukup mudah untuk dipahami.</p><p>Statement <code>syntax = &quot;proto3&quot;;</code>, artinya adalah versi proto yang digunakan adalah <code>proto3</code>. Ada juga versi <code>proto2</code>, namun kita tidak menggunakannya.</p><p>Statement <code>package model;</code>, digunakan untuk menge-set nama package dari file yang nantinya di-generate. File <code>user.proto</code> akan di-compile, menghasilkan file <code>user.pb.go</code>. File golang tersebut package-nya adalah sesuai dengan yang sudah didefinisikan di statement, pada contoh ini <code>model</code>.</p><p>Statement <code>enum UserGender</code> digunakan untuk pendefinisian enum. Tulis nama-nama enum beserta value di dalam kurung kurawal. Keyword <code>UserGender</code> sendiri nantinya menjadi tipe enum. Value enum di protobuf hanya bisa menggunakan tipe data numerik int.</p><p>Setelah proses kompilasi ke bentuk golang, kode di atas kurang lebihnya akan menjadi seperti berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">package</span> model

<span class="hljs-keyword">type</span> UserGender <span class="hljs-keyword">int32</span>

<span class="hljs-keyword">const</span> (
    UserGender_UNDEFINED UserGender = <span class="hljs-number">0</span>
    UserGender_MALE      UserGender = <span class="hljs-number">1</span>
    UserGender_FEMALE    UserGender = <span class="hljs-number">2</span>
)
</code></pre><p>Selanjutnya tambahkan statement pendefinisian message berikut dalam file <code>user.proto</code>.</p><pre><code class="lang-protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-built_in">string</span> id = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">string</span> name = <span class="hljs-number">2</span>;
    <span class="hljs-built_in">string</span> password = <span class="hljs-number">3</span>;
    UserGender gender = <span class="hljs-number">4</span>;
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">UserList</span> </span>{
    <span class="hljs-keyword">repeated</span> User list = <span class="hljs-number">1</span>;
}
</code></pre><blockquote><p>Untuk mengurangi moskimunikasi, penulis gunakan istilah <strong>model</strong> untuk <code>message</code> pada kode di atas.</p></blockquote><p>Model didefinisikan menggunakan keyword <code>message</code> diikuti dengan nama model-nya. Di dalam kurung kurawal, ditulis property-property model dengan skema penulisan <code>&lt;tipe data&gt; &lt;nama property&gt; = &lt;numbered field&gt;</code>.</p><blockquote><p>Bisa dilihat bahwa di tiap field terdapat <em>unique number</em>. Informasi ini berguna untuk versioning model protobuf. Tiap field harus memiliki angka yang unik satu sama lain dalam satu <code>message</code>.</p></blockquote><p>Di dalam <code>User</code>, dideklarasikan property <code>id</code>, <code>name</code>, dan <code>password</code> yang bertipe <code>string</code>; dan juga property <code>gender</code> yang bertipe enum <code>UserGender</code>.</p><p>Selain <code>User</code>, model <code>UserList</code> juga didefinisikan. Isinya hanya satu property yaitu <code>list</code> yang tipe-nya adalah <code>User</code>. Keyword repeated pada property digunakan untuk pendefinisian tipe array atau slice. Statement <code>repeated User</code> adalah ekuivalen dengan <code>[]*User</code> (tipe element slice pasti pointer).</p><p>Kode protobuf di atas menghasilkan kode golang berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Id       <span class="hljs-keyword">string</span>
    Name     <span class="hljs-keyword">string</span>
    Password <span class="hljs-keyword">string</span>
    Gender   UserGender
}

<span class="hljs-keyword">type</span> UserList <span class="hljs-keyword">struct</span> {
    List []*User
}
</code></pre><h4 id="file-garageproto">&#x2022; File <code>garage.proto</code></h4><p>Sekarang beralih ke file ke-dua, <code>garage.proto</code>. Silakan tulis kode berikut.</p><pre><code class="lang-protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;

<span class="hljs-keyword">package</span> model;

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GarageCoordinate</span> </span>{
    <span class="hljs-built_in">float</span> latitude = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">float</span> longitude = <span class="hljs-number">2</span>;
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Garage</span> </span>{
    <span class="hljs-built_in">string</span> id = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">string</span> name = <span class="hljs-number">2</span>;
    GarageCoordinate coordinate = <span class="hljs-number">3</span>;
}
</code></pre><p>Bisa dilihat, property <code>coordinate</code> pada model <code>Garage</code> tipe-nya adalah model juga, yaitu <code>GarageCoordinate</code>.</p><p>Di atas, tipe data <code>float</code> digunakan pada pendefinisian property <code>latitude</code> dan <code>longitude</code>. Silakan merujuk ke link berikut untuk mengetahui tipe-tipe primitif apa saja yang bisa digunakan sebagai tipe data property model <a href="https://developers.google.com/protocol-buffers/docs/proto3#scalar"target="_blank">https://developers.google.com/protocol-buffers/docs/proto3#scalar</a>.</p><p>Buat dua buah model lainnya berikut ini.</p><pre><code class="lang-protobuf"><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GarageList</span> </span>{
    <span class="hljs-keyword">repeated</span> Garage list = <span class="hljs-number">1</span>;
}

<span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">GarageListByUser</span> </span>{
    map&lt;<span class="hljs-built_in">string</span>, GarageList&gt; list = <span class="hljs-number">1</span>;
}
</code></pre><p>Selain array/slice, tipe <code>map</code> juga bisa digunakan pada protobuf. Gunakan keyword <code>map</code> untuk mendefinisikan tipe map. Penulisannya disertai dengan penulisan tipe data key dan tipe data value map tersebut.</p><blockquote><p>Penulisan tipe data map mirip seperti penulisan HashMap pada java yang disisipkan juga tipe generics-nya.</p></blockquote><p>Kembali ke topik, dua message di atas akan menghasilkan kode golang berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">type</span> GarageList <span class="hljs-keyword">struct</span> {
    List []*Garage
}

<span class="hljs-keyword">type</span> GarageListByUser <span class="hljs-keyword">struct</span> {
    List <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*GarageList
}
</code></pre><h2 id="c294-kompilasi-file-proto">C.29.4. Kompilasi File <code>.Proto</code></h2><p>File <code>.proto</code> sudah siap, sekarang saatnya untuk meng-compile file-file tersebut agar menjadi <code>.go</code>. Kompilasi dilakukan lewat command <code>protoc</code>. Agar output berupa file golang, maka gunakan flag <code>--go_out</code>. Lebih jelasnya silakan ikut command berikut.</p><pre><code class="lang-bash">novalagung:model $ protoc --go_out=. *.proto
novalagung:model $ tree .
.
&#x251C;&#x2500;&#x2500; garage.pb.go
&#x251C;&#x2500;&#x2500; garage.proto
&#x251C;&#x2500;&#x2500; user.pb.go
&#x2514;&#x2500;&#x2500; user.proto

0 directories, 4 files
</code></pre><p>Dua file baru dengan ekstensi <code>.pb.go</code> muncul.</p><h2 id="c295-praktek">C.29.5. Praktek</h2><p>Sekarang kita akan belajar tentang pengoperasian file proto yang sudah di-generate. Buka file <code>main.go</code>, tulis kode berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;bytes&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>

    <span class="hljs-comment">// sesuaikan dengan struktuk folder projek masing2</span>
    <span class="hljs-string">&quot;dasarpemrogramangolang/chapter-B.29/model&quot;</span>
)

<span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// more code here ...</span>
}
</code></pre><p>Package model yang isinya generated proto file, di-import. Dari package tersebut, kita bisa mengakses generated struct seperti <code>model.User</code>, <code>model.GarageList</code>, dan lainnya. Maka coba buat beberapa objek untuk kesemua generated struct.</p><ul><li><p>Objek struct <code>model.User</code>:</p><pre><code class="lang-go"> <span class="hljs-keyword">var</span> user1 = &amp;model.User{
     Id:       <span class="hljs-string">&quot;u001&quot;</span>,
     Name:     <span class="hljs-string">&quot;Sylvana Windrunner&quot;</span>,
     Password: <span class="hljs-string">&quot;f0r Th3 H0rD3&quot;</span>,
     Gender:   model.UserGender_FEMALE,
 }
</code></pre><p>Untuk tipe enum pengaksesannya seperti di atas, penulisannya <code>model.UserGender_*</code>. Cukup ubah <code>*</code> dengan value yang diinginkan, <code>UNDEFINED</code>, <code>MALE</code>, atau <code>FEMALE</code>.</p></li><li><p>Objek struct <code>model.UserList</code>:</p><pre><code class="lang-go"> <span class="hljs-keyword">var</span> userList = &amp;model.UserList{
     List: []*model.User{
         user1,
     },
 }
</code></pre><p>Disarankan untuk selalu menampung objek cetakan struct protobuf dalam bentuk pointer, karena dengan itu objek akan memenuhi kriteria interface <code>proto.Message</code>, yang nantinya akan sangat membantu proses koding.</p></li><li><p>Objek struct <code>model.Garage</code>:</p><pre><code class="lang-go"> <span class="hljs-keyword">var</span> garage1 = &amp;model.Garage{
     Id:   <span class="hljs-string">&quot;g001&quot;</span>,
     Name: <span class="hljs-string">&quot;Kalimdor&quot;</span>,
     Coordinate: &amp;model.GarageCoordinate{
         Latitude:  <span class="hljs-number">23.2212847</span>,
         Longitude: <span class="hljs-number">53.22033123</span>,
     },
 }
</code></pre></li><li><p>Objek struct <code>model.GarageList</code>:</p><pre><code class="lang-go"> <span class="hljs-keyword">var</span> garageList = &amp;model.GarageList{
     List: []*model.Garage{
         garage1,
     },
 }
</code></pre></li><li><p>Objek struct <code>model.GarageListByUser</code>:</p><pre><code class="lang-go"> <span class="hljs-keyword">var</span> garageListByUser = &amp;model.GarageListByUser{
     List: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]*model.GarageList{
         user1.Id: garageList,
     },
 }
</code></pre></li></ul><h4 id="print-proto-object">&#x2022; Print proto object</h4><p>Print salah satu objek yang sudah dibuat di atas.</p><pre><code class="lang-go"><span class="hljs-comment">// =========== original</span>
fmt.Printf(<span class="hljs-string">&quot;# ==== Original\n       %#v \n&quot;</span>, user1)

<span class="hljs-comment">// =========== as string</span>
fmt.Printf(<span class="hljs-string">&quot;# ==== As String\n       %v \n&quot;</span>, user1.String())
</code></pre><p>Jalankan aplikasi untuk melihat hasilnya.</p><p><img alt="Print object protobuf"src="images/C.29_3_print.png"></p><p>Pada statement print pertama, objek ditampilkan apa adanya. Generated struct memiliki beberapa property lain selain yang sudah didefinisikan pada proto message, seperti <code>XXX_unrecognized</code> dan beberapa lainnya. Property tersebut dibutuhkan oleh protobuf, tapi tidak kita butuhkan, jadi biarkan saja.</p><p>Di statement print kedua, method <code>.String()</code> diakses, menampilkan semua property yang didefinisikan dalam proto message (property <code>XXX_</code> tidak dimunculkan).</p><h4 id="konversi-objek-proto-ke-json-string">&#x2022; Konversi objek proto ke json string</h4><p>Tambahkan kode berikut:</p><pre><code class="lang-go"><span class="hljs-comment">// =========== as json string</span>
<span class="hljs-keyword">var</span> buf bytes.Buffer
err1 := (&amp;jsonpb.Marshaler{}).Marshal(&amp;buf, garageList)
<span class="hljs-keyword">if</span> err1 != <span class="hljs-literal">nil</span> {
    fmt.Println(err1.Error())
    os.Exit(<span class="hljs-number">0</span>)
}
jsonString := buf.String()
fmt.Printf(<span class="hljs-string">&quot;# ==== As JSON String\n       %v \n&quot;</span>, jsonString)
</code></pre><p>Di atas kita membuat banyak objek lewat generated struct. Objek tersebut bisa dikonversi ke bentuk JSON string, caranya dengan memanfaatkan package <a href="https://github.com/golang/protobuf/"target="_blank">github.com/golang/protobuf/jsonpb</a>. Lakukan <code>go get</code> pada package jika belum punya, dan jangan lupa untuk meng-importnya pada file yang sedang dibuat.</p><p>Kembali ke pembahasan, buat objek pointer baru dari struct <code>jsonpb.Marshaler</code>, lalu akses method <code>.Marshal()</code>. Sisipkan objek bertipe <code>io.Writer</code> penampung hasil konversi sebagai parameter pertama (pada contoh di atas kita gunakan <code>bytes.Buffer</code>). Lalu sisipkan juga objek proto yang ingin dikonversi sebagai parameter kedua.</p><p>Jalankan aplikasi, cek hasilnya.</p><p><img alt="Print as JSON string"src="images/C.29_4_print_json.png"></p><p>Selain method <code>.Marshal()</code>, konversi ke json string bisa dilakukan lewat method <code>.MarshalToString()</code>.</p><h4 id="konversi-json-string-ke-objek-proto">&#x2022; Konversi json string ke objek proto</h4><p>Proses unmarshal dari json string ke objek proto, bisa dilakukan lewat dua cara:</p><ul><li><p>Membuat objek pointer dari struct <code>jsonpb.Unmarshaler</code>, lalu mengakses method <code>.Unmarshal()</code>. Parameter pertama diisi dengan objek <code>io.Reader</code> yang isinya json string, dan parameter kedua adalah receiver.</p><pre><code class="lang-go"> buf2 := strings.NewReader(jsonString)
 protoObject := <span class="hljs-built_in">new</span>(model.GarageList)

 err2 := (&amp;jsonpb.Unmarshaler{}).Unmarshal(buf2, protoObject)
 <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
     fmt.Println(err2.Error())
     os.Exit(<span class="hljs-number">0</span>)
 }

 fmt.Printf(<span class="hljs-string">&quot;# ==== As String\n       %v \n&quot;</span>, protoObject.String())
</code></pre></li><li><p>Menggunakan <code>jsonpb.UnmarshalString</code>, dengan parameter pertama disisipi data json string.</p><pre><code class="lang-go"> protoObject := <span class="hljs-built_in">new</span>(model.GarageList)

 err2 := jsonpb.UnmarshalString(jsonString, protoObject)
 <span class="hljs-keyword">if</span> err2 != <span class="hljs-literal">nil</span> {
     fmt.Println(err2.Error())
     os.Exit(<span class="hljs-number">0</span>)
 }

 fmt.Printf(<span class="hljs-string">&quot;# ==== As String\n       %v \n&quot;</span>, protoObject.String())
</code></pre></li></ul><p>Silakan pilih cara yang cocok sesuai kebutuhan. Lalu jalankan aplikasi dan lihat hasilnya.</p><p><img alt="Unmarshal from JSON string"src="images/C.29_5_unmarshal.png"></p><h2 id="c296-grpc--protobuf">C.29.6. gRPC + Protobuf</h2><p>Pada bab selanjutnya kita akan belajar tentang penerapan gRPC dan protobuf.</p><hr><ul><li><a href="https://github.com/golang/protobuf"target="_blank">Protobuf</a>, by Google, BSD-3-Clause License</li></ul></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title">results matching ""</h1></div><div class="no-results"><h1 class="search-results-title">No results matching ""</h1></div></div></div></div></div></div><a href="C-28-golang-web-socket.html"class="navigation navigation-prev"aria-label="Previous page: C.28. Web Socket: Chatting App"></a><a href="C-30-golang-grpc-protobuf.html"class="navigation navigation-next"aria-label="Next page: C.30. gRPC + Protobuf"></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"C.29. Protobuf",level:"1.4.28",depth:2,next:{title:"C.30. gRPC + Protobuf",level:"1.4.29",depth:2,path:"C-30-golang-grpc-protobuf.md",ref:"C-30-golang-grpc-protobuf.md",articles:[]},previous:{title:"C.28. Web Socket: Chatting App",level:"1.4.27",depth:2,path:"C-28-golang-web-socket.md",ref:"C-28-golang-web-socket.md",articles:[]},dir:"ltr"},config:{plugins:["ga","html-minifier","disqus","meta","sitemap","scripts"],styles:{website:"styles/website.css"},pluginsConfig:{disqus:{useIdentifier:!1,shortName:"dasarpemrogramangolang"},meta:{content:"",data:[{name:"google-site-verification",content:"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{name:"og:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{name:"twitter:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],name:""},scripts:{files:[]},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!0,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},highlight:{},sitemap:{hostname:"https://dasarpemrogramangolang.novalagung.com/"},ga:{configuration:"auto",token:"UA-27602984-29"},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1}},theme:"default",lunr:{maxIndexSize:1e9},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},gitbook:"*"},file:{path:"C-29-golang-protobuf-implementation.md",mtime:"2018-10-01T05:28:09.628Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2018-12-07T00:59:33.615Z"},basePath:".",book:{language:""}})})</script></div><script src="gitbook/gitbook.js"></script><script src="gitbook/theme.js"></script><script src="gitbook/gitbook-plugin-ga/plugin.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="gitbook/gitbook-plugin-search/search-engine.js"></script><script src="gitbook/gitbook-plugin-search/search.js"></script><script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script></body></html>